<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>魔导工坊: 高能过载 (修复版)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="h-screen w-screen flex flex-col relative bg-black">

    <!-- 顶部信息栏 -->
    <div class="flex-none h-14 bg-slate-900/90 border-b border-slate-800 flex items-center justify-between px-4 z-20">
        <div>
            <div class="text-[10px] text-slate-500">SYSTEM</div>
            <div class="text-sm font-bold text-green-400 neon-text">AETHER PHYSICS</div>
        </div>
        <div class="text-right">
            <div class="text-[10px] text-slate-500">SCORE</div>
            <div class="text-xl font-bold text-yellow-400" id="score-display">0</div>
        </div>
    </div>

    <!-- 主游戏区 (自适应) -->
    <div id="game-container" class="flex-1 relative flex items-center justify-center bg-[#050505] overflow-hidden">
        <!-- 背景 Canvas (渲染能量场) -->
        <canvas id="bgCanvas" class="absolute z-0 opacity-40"></canvas>
        
        <!-- 前景 Canvas (渲染元件) -->
        <canvas id="mainCanvas" class="relative z-10"></canvas>

        <!-- 运行开关 (右下角) -->
        <button id="runBtn" onclick="toggleRun()" class="absolute bottom-6 right-6 w-16 h-16 rounded-full bg-slate-800 border-2 border-green-500 shadow-lg shadow-green-900/50 flex items-center justify-center z-20 active:scale-95 transition">
            <span id="run-icon" class="text-2xl">⚡</span>
        </button>
        
        <!-- 清空按钮 (左下角) -->
        <button onclick="clearMap()" class="absolute bottom-6 left-6 w-12 h-12 rounded-full bg-slate-900 border border-slate-700 flex items-center justify-center z-20 text-slate-500 active:scale-95">
            <span class="text-xs">CLR</span>
        </button>

        <!-- 警告层 -->
        <div id="alert-layer" class="absolute inset-0 pointer-events-none z-30 transition-colors duration-200"></div>
    </div>

    <!-- 底部工具栏 -->
    <div class="flex-none h-24 bg-slate-900 border-t border-slate-800 z-20 flex flex-col pb-safe">
        <div class="flex-none px-3 py-1 bg-black/20 text-[10px] text-slate-400 flex justify-between">
            <span>TOOLBOX</span>
            <span id="tool-name" class="text-green-400">选择元件...</span>
        </div>
        
        <div class="flex-1 overflow-x-auto hide-scrollbar flex items-center gap-2 px-3">
            <!-- 抽取泵 -->
            <button onclick="selectTool('extractor', '抽取泵: 放置在高亮区域抽取能量')" id="btn-extractor" class="tool-btn flex-none w-14 h-14 rounded flex flex-col items-center justify-center gap-1 active">
                <div class="w-3 h-3 bg-green-500 shadow-[0_0_8px_#4ade80]"></div>
                <span class="text-[9px] text-slate-300">抽取</span>
            </button>
            
            <!-- 传输线 -->
            <button onclick="selectTool('wire', '超导线: 传输能量')" id="btn-wire" class="tool-btn flex-none w-14 h-14 rounded flex flex-col items-center justify-center gap-1">
                <div class="w-6 h-0.5 bg-green-500"></div>
                <span class="text-[9px] text-slate-300">导线</span>
            </button>

            <!-- 电池/电容 -->
            <button onclick="selectTool('battery', '电容堆: 储存大量能量 (防过载缓冲)')" id="btn-battery" class="tool-btn flex-none w-14 h-14 rounded flex flex-col items-center justify-center gap-1">
                <div class="w-3 h-4 border border-green-500"></div>
                <span class="text-[9px] text-slate-300">电容</span>
            </button>

            <!-- 排气阀 -->
            <button onclick="selectTool('vent', '排气阀: 安全排放多余能量 (防止爆炸)')" id="btn-vent" class="tool-btn flex-none w-14 h-14 rounded flex flex-col items-center justify-center gap-1">
                <div class="flex gap-0.5">
                    <div class="w-0.5 h-3 bg-slate-400"></div><div class="w-0.5 h-3 bg-slate-400"></div><div class="w-0.5 h-3 bg-slate-400"></div>
                </div>
                <span class="text-[9px] text-slate-300">排气</span>
            </button>
            
            <div class="w-px h-8 bg-slate-700 mx-1"></div>

            <!-- 物质生成器 -->
            <button onclick="selectTool('maker', '物质发生器: 消耗能量制造粒子')" id="btn-maker" class="tool-btn flex-none w-14 h-14 rounded flex flex-col items-center justify-center gap-1">
                <div class="w-3 h-3 rounded-full bg-white"></div>
                <span class="text-[9px] text-slate-300">发生器</span>
            </button>

            <!-- 磁轨 -->
            <button onclick="selectTool('rail', '磁轨: 消耗能量加速粒子')" id="btn-rail" class="tool-btn flex-none w-14 h-14 rounded flex flex-col items-center justify-center gap-1">
                <div class="text-[10px] text-yellow-500 font-bold">>>></div>
                <span class="text-[9px] text-slate-300">磁轨</span>
            </button>
            
            <!-- 发射口 -->
            <button onclick="selectTool('emitter', '发射终端: 粒子的终点')" id="btn-emitter" class="tool-btn flex-none w-14 h-14 rounded flex flex-col items-center justify-center gap-1">
                <div class="w-3 h-3 border border-yellow-500"></div>
                <span class="text-[9px] text-slate-300">终端</span>
            </button>

            <div class="w-px h-8 bg-slate-700 mx-1"></div>

            <!-- 拆除 -->
            <button onclick="selectTool('eraser', '拆除元件')" id="btn-eraser" class="tool-btn flex-none w-14 h-14 rounded flex flex-col items-center justify-center gap-1 text-red-500">
                <span class="text-xl font-bold">×</span>
            </button>
            
            <div class="w-4 flex-none"></div>
        </div>
    </div>

    <script src="js/app.js"></script>
</body>
</html>
